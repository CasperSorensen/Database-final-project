@using Newtonsoft.Json
@model ObjectOfFieldsForDatabase
@{
    Layout = null;
}

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>CheckoutPage</title>
</head>
<body>
    @{

        //error handeling
        //rollback
        //unit price on invoiceline
        //amount 10,2
        //ccv string
        //iban string
        //coMMent textfied
        //fix the relationsin ERD

       

        var invoiceId = AzureDb.Instance.InsertInvoice(Model);

        Dictionary<int, int> Basket = JsonConvert.DeserializeObject<Dictionary<int, int>>(Model.Products);
        List<int> products = new List<int>();

        foreach (var product in Basket)
        {

            int ProductID = product.Key;
            int Quantity = product.Value;
            decimal UnitPrice = AzureDb.Instance.GetUnitPriceForProduct(ProductID);

            var result = AzureDb.Instance.InsertInvoiceLine(invoiceId, ProductID, Quantity, UnitPrice);

            <h2>result is: @result</h2>
        }








        <h1>InvoiceId is : @invoiceId !!1</h1>
        <p>UserId: @Model.UserId</p>
        
        foreach (var product in Basket)
        {
            <p> ProductId: @product.Key , Quant: @product.Value</p>
            
        }
        <p>Card Id : @Model.CreditCardId</p>
        <p>Total: @Model.Total DKK</p>



    }

</body>
</html>
